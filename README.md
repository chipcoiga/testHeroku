-- MySQL Script generated by MySQL Workbench
-- 07/07/16 13:57:04
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema karaokedb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema karaokedb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `karaokedb` DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ;
USE `karaokedb` ;

-- -----------------------------------------------------
-- Table `karaokedb`.`action_type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`action_type` (
  `action_typeid` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `description` VARCHAR(200) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  PRIMARY KEY (`action_typeid`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`facility_status`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`facility_status` (
  `facility_statusid` INT(11) NOT NULL AUTO_INCREMENT,
  `status` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  PRIMARY KEY (`facility_statusid`))
ENGINE = InnoDB
AUTO_INCREMENT = 4
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`user_role`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`user_role` (
  `user_roleid` INT(11) NOT NULL AUTO_INCREMENT,
  `role` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `description` VARCHAR(200) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  PRIMARY KEY (`user_roleid`))
ENGINE = InnoDB
AUTO_INCREMENT = 4
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`user` (
  `userid` INT(11) NOT NULL AUTO_INCREMENT,
  `email` VARCHAR(255) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `password` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `nickname` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `phone` VARCHAR(15) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `address` VARCHAR(255) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `avatarid` INT(11) NULL DEFAULT NULL,
  `contact_name` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `country` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `city` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `roleid` INT(11) NOT NULL DEFAULT '0',
  `isdelete` TINYINT(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`userid`),
  INDEX `fk_user_user_role1_idx` (`roleid` ASC),
  CONSTRAINT `fk_user_user_role1`
    FOREIGN KEY (`roleid`)
    REFERENCES `karaokedb`.`user_role` (`user_roleid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 219
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`facilities`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`facilities` (
  `facilityid` INT(11) NOT NULL AUTO_INCREMENT,
  `userid` INT(11) NOT NULL,
  `name` VARCHAR(255) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `address` VARCHAR(255) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `final_rating` FLOAT NULL DEFAULT NULL,
  `city` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `country` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `description` LONGTEXT CHARACTER SET 'utf8' NULL DEFAULT NULL,
  `status` INT(11) NOT NULL DEFAULT '1',
  `isdelete` TINYINT(1) NULL DEFAULT '0',
  `create_time` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `facilitiescol` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `readed` INT(11) NOT NULL,
  `locationId` INT(11) NOT NULL,
  PRIMARY KEY (`facilityid`),
  INDEX `fk_facilities_user1_idx` (`userid` ASC),
  INDEX `fk_facilities_FacilityStatus1_idx` (`status` ASC),
  INDEX `facilities` (`name` ASC, `address` ASC, `description`(255) ASC),
  INDEX `address` (`address` ASC, `description`(255) ASC),
  INDEX `address_2` (`address` ASC),
  CONSTRAINT `fk_facilities_FacilityStatus1`
    FOREIGN KEY (`status`)
    REFERENCES `karaokedb`.`facility_status` (`facility_statusid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_facilities_user1`
    FOREIGN KEY (`userid`)
    REFERENCES `karaokedb`.`user` (`userid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 418
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`room_type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`room_type` (
  `room_typeid` INT(11) NOT NULL AUTO_INCREMENT,
  `facilityid` INT(11) NOT NULL,
  `type_name` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `max_people` INT(11) NULL DEFAULT NULL,
  `cost` INT(11) NULL DEFAULT NULL,
  `room_amount` INT(11) NOT NULL DEFAULT '0',
  `room_available_amount` INT(11) NULL DEFAULT '0',
  `descriptions` VARCHAR(500) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `isroom_type_delete` TINYINT(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`room_typeid`))
ENGINE = InnoDB
AUTO_INCREMENT = 407
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`booking`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`booking` (
  `bookingid` INT(11) NOT NULL AUTO_INCREMENT,
  `start_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `duration` INT(11) NULL DEFAULT NULL COMMENT 'duration of time the customer want to use this room',
  `contact_name` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `phone` VARCHAR(15) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `customer_note` VARCHAR(500) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `facility_note` VARCHAR(500) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `isaccept` INT(1) NOT NULL,
  `customerid` INT(11) NOT NULL,
  `facilityid` INT(11) NOT NULL,
  `room_typeid` INT(11) NOT NULL,
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `bookingcol` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `readed` INT(11) NOT NULL,
  PRIMARY KEY (`bookingid`),
  INDEX `fk_booking_user1_idx` (`customerid` ASC),
  INDEX `fk_booking_facilities1_idx` (`facilityid` ASC),
  INDEX `fk_booking_room_type1_idx` (`room_typeid` ASC),
  CONSTRAINT `fk_booking_facilities1`
    FOREIGN KEY (`facilityid`)
    REFERENCES `karaokedb`.`facilities` (`facilityid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_booking_room_type1`
    FOREIGN KEY (`room_typeid`)
    REFERENCES `karaokedb`.`room_type` (`room_typeid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_booking_user1`
    FOREIGN KEY (`customerid`)
    REFERENCES `karaokedb`.`user` (`userid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 372
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`booking_nofi`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`booking_nofi` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `userId` INT(11) NOT NULL,
  `bookingId` INT(11) NOT NULL,
  `Type` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `readed` INT(11) NOT NULL,
  `facilityId_ProviderId` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 4976
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`ca_cost`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`ca_cost` (
  `idca_cost` INT(11) NOT NULL AUTO_INCREMENT,
  `cost` INT(11) NOT NULL,
  PRIMARY KEY (`idca_cost`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`ca_num_date`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`ca_num_date` (
  `idca_num_date` INT(11) NOT NULL AUTO_INCREMENT,
  `num_date` INT(11) NOT NULL,
  PRIMARY KEY (`idca_num_date`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`ca_type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`ca_type` (
  `idca_type` INT(11) NOT NULL AUTO_INCREMENT,
  `type_name` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `max_faci_num` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`idca_type`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`comment`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`comment` (
  `commentid` INT(11) NOT NULL AUTO_INCREMENT,
  `customerid` INT(11) NOT NULL,
  `facilityid` INT(11) NOT NULL,
  `title` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `content` VARCHAR(500) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `ratingid` INT(11) NOT NULL,
  `status` INT(11) NOT NULL,
  PRIMARY KEY (`commentid`),
  INDEX `fk_comment_user1_idx` (`customerid` ASC),
  INDEX `fk_comment_facilities1_idx` (`facilityid` ASC),
  CONSTRAINT `fk_comment_facilities1`
    FOREIGN KEY (`facilityid`)
    REFERENCES `karaokedb`.`facilities` (`facilityid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_comment_user1`
    FOREIGN KEY (`customerid`)
    REFERENCES `karaokedb`.`user` (`userid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 177
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`facility_image`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`facility_image` (
  `facility_imageid` INT(11) NOT NULL AUTO_INCREMENT,
  `facilityid` INT(11) NOT NULL,
  `title` VARCHAR(255) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `facility_image` LONGBLOB NULL DEFAULT NULL,
  `islogo` TINYINT(1) NOT NULL DEFAULT '0',
  `image_data` LONGBLOB NULL DEFAULT NULL,
  `ImageName` VARCHAR(155) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `ImageSize` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `ImageType` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  PRIMARY KEY (`facility_imageid`, `facilityid`),
  INDEX `fk_facilityimage_facilities1_idx` (`facilityid` ASC),
  CONSTRAINT `fk_facilityimage_facilities1`
    FOREIGN KEY (`facilityid`)
    REFERENCES `karaokedb`.`facilities` (`facilityid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 1307
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`facility_service_category`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`facility_service_category` (
  `facility_service_cateid` INT(11) NOT NULL AUTO_INCREMENT,
  `Created_by` INT(11) NOT NULL DEFAULT '0',
  `service_name` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `service_icon` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `description` VARCHAR(500) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `isDeleted` TINYINT(1) NOT NULL DEFAULT '0',
  `Created_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `Updated_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`facility_service_cateid`))
ENGINE = InnoDB
AUTO_INCREMENT = 18
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`facility_service`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`facility_service` (
  `facility_serviceid` INT(11) NOT NULL AUTO_INCREMENT,
  `facilityid` INT(11) NOT NULL,
  `serviceid` INT(11) NOT NULL,
  `Created_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `Updated_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `isDeleted` TINYINT(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`facility_serviceid`),
  INDEX `facility_idx` (`facilityid` ASC),
  INDEX `service_idx` (`serviceid` ASC),
  CONSTRAINT `facility`
    FOREIGN KEY (`facilityid`)
    REFERENCES `karaokedb`.`facilities` (`facilityid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `service`
    FOREIGN KEY (`serviceid`)
    REFERENCES `karaokedb`.`facility_service_category` (`facility_service_cateid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 124
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`image`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`image` (
  `id` INT(11) NOT NULL,
  `image` BLOB NULL DEFAULT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`unit`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`unit` (
  `idunit` INT(11) NOT NULL AUTO_INCREMENT,
  `unit_name` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  PRIMARY KEY (`idunit`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`item`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`item` (
  `iditem` INT(11) NOT NULL AUTO_INCREMENT,
  `item_name` VARCHAR(200) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `idunit` INT(11) NULL DEFAULT NULL,
  `creater` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`iditem`),
  INDEX `item unit_idx` (`idunit` ASC),
  INDEX `creater usetid_idx` (`creater` ASC),
  CONSTRAINT `creater usetid`
    FOREIGN KEY (`creater`)
    REFERENCES `karaokedb`.`user` (`userid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `item unit`
    FOREIGN KEY (`idunit`)
    REFERENCES `karaokedb`.`unit` (`idunit`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`item_price`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`item_price` (
  `iditem_price` INT(11) NOT NULL AUTO_INCREMENT,
  `idfacility` INT(11) NULL DEFAULT NULL,
  `iditem` INT(11) NULL DEFAULT NULL,
  `before6pm` INT(11) NULL DEFAULT NULL,
  `after6pm` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`iditem_price`),
  INDEX `item facility_idx` (`idfacility` ASC),
  INDEX `item prive item_idx` (`iditem` ASC),
  CONSTRAINT `item price facility`
    FOREIGN KEY (`idfacility`)
    REFERENCES `karaokedb`.`facilities` (`facilityid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `item prive item`
    FOREIGN KEY (`iditem`)
    REFERENCES `karaokedb`.`item` (`iditem`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`license_type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`license_type` (
  `idlicense` INT(11) NOT NULL AUTO_INCREMENT,
  `idca_type` INT(11) NOT NULL,
  `idca_num_date` INT(11) NOT NULL,
  `idca_cost` INT(11) NOT NULL,
  PRIMARY KEY (`idlicense`),
  INDEX `license type_idx` (`idca_type` ASC),
  INDEX `license money_idx` (`idca_cost` ASC),
  INDEX `license date_idx` (`idca_num_date` ASC),
  CONSTRAINT `license date`
    FOREIGN KEY (`idca_num_date`)
    REFERENCES `karaokedb`.`ca_num_date` (`idca_num_date`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `license money`
    FOREIGN KEY (`idca_cost`)
    REFERENCES `karaokedb`.`ca_cost` (`idca_cost`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `license type`
    FOREIGN KEY (`idca_type`)
    REFERENCES `karaokedb`.`ca_type` (`idca_type`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`license`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`license` (
  `idlicense` INT(11) NOT NULL AUTO_INCREMENT,
  `idprovider` INT(11) NULL DEFAULT NULL,
  `date_created` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `date_start` TIMESTAMP NULL DEFAULT NULL,
  `date_expired` TIMESTAMP NULL DEFAULT NULL,
  `idlicense_type` INT(11) NULL DEFAULT NULL,
  `isactive` TINYINT(1) NULL DEFAULT NULL,
  PRIMARY KEY (`idlicense`),
  INDEX `lisence provider_idx` (`idprovider` ASC),
  INDEX `licensetype_idx` (`idlicense_type` ASC),
  CONSTRAINT `licensetype`
    FOREIGN KEY (`idlicense_type`)
    REFERENCES `karaokedb`.`license_type` (`idlicense`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `lisence provider`
    FOREIGN KEY (`idprovider`)
    REFERENCES `karaokedb`.`user` (`userid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`location`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`location` (
  `locationId` INT(11) NOT NULL AUTO_INCREMENT,
  `location_name` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  PRIMARY KEY (`locationId`),
  INDEX `locationId` (`locationId` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 6
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`nofitication`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`nofitication` (
  `nofiticationId` INT(11) NOT NULL AUTO_INCREMENT,
  `userId` INT(11) NOT NULL,
  `changed` TINYINT(1) NULL DEFAULT NULL,
  `created_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  `type` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  PRIMARY KEY (`nofiticationId`))
ENGINE = InnoDB
AUTO_INCREMENT = 97
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`rating`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`rating` (
  `ratingid` INT(11) NOT NULL AUTO_INCREMENT,
  `views` FLOAT NULL DEFAULT NULL,
  `services` FLOAT NULL DEFAULT NULL,
  `quality` FLOAT NULL DEFAULT NULL,
  `price` FLOAT NULL DEFAULT NULL,
  PRIMARY KEY (`ratingid`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`room_type_service`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`room_type_service` (
  `room_type_serviceid` INT(11) NOT NULL AUTO_INCREMENT,
  `room_typeid` INT(11) NOT NULL,
  `serviceid` INT(11) NOT NULL,
  PRIMARY KEY (`room_type_serviceid`),
  INDEX `room_typeid_idx` (`room_typeid` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 161
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`rooms`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`rooms` (
  `roomid` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `isopen` TINYINT(1) NOT NULL,
  `room_typeid` INT(11) NOT NULL,
  PRIMARY KEY (`roomid`),
  INDEX `fk_rooms_room_type1_idx` (`room_typeid` ASC),
  CONSTRAINT `fk_rooms_room_type1`
    FOREIGN KEY (`room_typeid`)
    REFERENCES `karaokedb`.`room_type` (`room_typeid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 6
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`service`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`service` (
  `serviceid` INT(11) NOT NULL AUTO_INCREMENT,
  `service_name` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `description` VARCHAR(200) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  PRIMARY KEY (`serviceid`))
ENGINE = InnoDB
AUTO_INCREMENT = 4
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `karaokedb`.`user_action`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`user_action` (
  `user_actionid` INT(11) NOT NULL,
  `actionid` INT(11) NOT NULL,
  `userid` INT(11) NOT NULL,
  PRIMARY KEY (`user_actionid`),
  INDEX `fk_user_action_user1_idx` (`userid` ASC),
  CONSTRAINT `fk_user_action_user1`
    FOREIGN KEY (`userid`)
    REFERENCES `karaokedb`.`user` (`userid`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;

USE `karaokedb` ;

-- -----------------------------------------------------
-- Placeholder table for view `karaokedb`.`bookingview`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`bookingview` (`bookingid` INT, `isaccept` INT, `room_typeid` INT, `room_available_amount` INT);

-- -----------------------------------------------------
-- Placeholder table for view `karaokedb`.`homepage_view`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `karaokedb`.`homepage_view` (`islogo` INT, `facilityid` INT, `name` INT, `address` INT, `final_rating` INT, `city` INT, `country` INT, `description` INT, `image_data` INT, `status` INT, `room_available_amount` INT);

-- -----------------------------------------------------
-- function SPLIT_STRING
-- -----------------------------------------------------

DELIMITER $$
USE `karaokedb`$$
CREATE DEFINER=`training`@`localhost` FUNCTION `SPLIT_STRING`( s VARCHAR(1024) , del CHAR(1) , i INT) RETURNS varchar(1024) CHARSET utf8 COLLATE utf8_unicode_ci
    DETERMINISTIC
BEGIN

        DECLARE n INT ;

        -- get max number of items
        SET n = LENGTH(s) - LENGTH(REPLACE(s, del, '')) + 1;

        IF i > n THEN
            RETURN NULL ;
        ELSE
            RETURN SUBSTRING_INDEX(SUBSTRING_INDEX(s, del, i) , del , -1 ) ;        
        END IF;

    END$$

DELIMITER ;

-- -----------------------------------------------------
-- View `karaokedb`.`bookingview`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `karaokedb`.`bookingview`;
USE `karaokedb`;
CREATE  OR REPLACE ALGORITHM=UNDEFINED DEFINER=`training`@`localhost` SQL SECURITY DEFINER VIEW `karaokedb`.`bookingview` AS select `b`.`bookingid` AS `bookingid`,`b`.`isaccept` AS `isaccept`,`r`.`room_typeid` AS `room_typeid`,`r`.`room_available_amount` AS `room_available_amount` from (`karaokedb`.`booking` `b` join `karaokedb`.`room_type` `r`) where (`b`.`room_typeid` = `r`.`room_typeid`);

-- -----------------------------------------------------
-- View `karaokedb`.`homepage_view`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `karaokedb`.`homepage_view`;
USE `karaokedb`;
CREATE  OR REPLACE ALGORITHM=UNDEFINED DEFINER=`client`@`%` SQL SECURITY DEFINER VIEW `karaokedb`.`homepage_view` AS select `fi`.`islogo` AS `islogo`,`f`.`facilityid` AS `facilityid`,`f`.`name` AS `name`,`f`.`address` AS `address`,`f`.`final_rating` AS `final_rating`,`f`.`city` AS `city`,`f`.`country` AS `country`,`f`.`description` AS `description`,`fi`.`image_data` AS `image_data`,`f`.`status` AS `status`,`r`.`room_available_amount` AS `room_available_amount` from ((`karaokedb`.`facilities` `f` join `karaokedb`.`facility_image` `fi`) join `karaokedb`.`room_type` `r` on(((`f`.`facilityid` = `fi`.`facilityid`) and (`r`.`facilityid` = `f`.`facilityid`) and (`fi`.`islogo` = 1))));

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
